{"ast":null,"code":"import _objectSpread from\"C:/Users/Lenovo/OneDrive/Documentos/SENA/CONI_FUNCIONES 10 NOV/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{useNavigate}from'react-router-dom';import logo from'../img/ESLOGAN CONI.png';import'./estilos.css';// copia tu CSS de sesion.css aquí\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Login(){// --- EXPLICACIÓN: useState ---\n// useState es un \"hook\" de React. Los hooks nos permiten usar el estado\n// y otras características de React en componentes de función.\n// En este caso, creamos un estado 'formData' para guardar los datos del formulario.\n// NOTA: Hemos quitado el campo 'rol' de aquí, ya que no lo necesitamos más.\nconst[formData,setFormData]=useState({username:'',password:''});const[mensaje,setMensaje]=useState('');const navigate=useNavigate();// --- EXPLICACIÓN: useEffect ---\n// Este hook ejecuta un código cada vez que el componente se renderiza.\n// El array vacío `[]` al final le dice a React que solo ejecute este código una vez,\n// cuando el componente se \"monta\" (cuando aparece en la página por primera vez).\n// Lo usamos para limpiar el localStorage.\nuseEffect(()=>{// Limpiamos el localStorage de cualquier sesión anterior.\n// Esto asegura que la aplicación empiece siempre de forma limpia.\nlocalStorage.removeItem(\"usuarioLogueado\");// También limpiamos los campos del formulario por si acaso.\nlocalStorage.removeItem(\"idUsuario\");localStorage.removeItem(\"cargoEmpleado\");const logoutMessage=localStorage.getItem(\"logoutMessage\");if(logoutMessage){setMensaje(logoutMessage);localStorage.removeItem(\"logoutMessage\");// Limpia el mensaje después de leerlo\n}},[]);// El array vacío `[]` es crucial para que solo se ejecute una vez.\n// --- EXPLICACIÓN: handleChange ---\n// Esta función es llamada cada vez que el usuario escribe en los campos del formulario.\n// Usa la sintaxis `...formData` para crear una copia de los datos actuales del formulario,\n// y luego actualiza solo el campo que ha cambiado ([e.target.name] con su e.target.value).\n// Ahora solo maneja 'username' y 'password'.\nconst handleChange=e=>{setFormData(_objectSpread(_objectSpread({},formData),{},{[e.target.name]:e.target.value}));};// --- EXPLICACIÓN: handleSubmit ---\n// Esta función se activa cuando el usuario envía el formulario.\n// Envía los datos al servidor (backend) y maneja la respuesta.\nconst handleSubmit=async e=>{e.preventDefault();setMensaje('');// Limpiar mensaje previo\n//verificamos que los campos no estén vacíos\nif(!formData.username||!formData.password){setMensaje('Por favor, ingrese su nombre de usuario y contraseña.');return;}try{// Usamos `fetch` para enviar una solicitud al servidor.\n// `async/await` nos permite trabajar con promesas (peticiones asíncronas)\n// de una manera más fácil de leer.\nconst response=await fetch('http://localhost:8080/CONI1.0/LoginServlet',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',// --- CAMBIO CLAVE AQUÍ ---\n// Ahora solo enviamos el nombre de usuario y la contraseña.\n// El rol ya no está en el `formData` que se envía.\nbody:JSON.stringify(formData)});// --- EXPLICACIÓN: JSON y Servlet ---\n// JSON (JavaScript Object Notation) es un formato ligero para el intercambio de datos.\n// Es como un idioma universal para que el frontend y el backend se comuniquen.\n// El `Servlet` es un programa en el servidor (backend) que procesa las peticiones web.\n// En este caso, tu `LoginServlet` recibe los datos del formulario.\nconst data=await response.json();// Si la respuesta del servidor es exitosa...\n// Ajuste aquí: el servlet devuelve 'success' y el rol está dentro de 'data.user.rolAutenticacion'\nif(response.ok&&data.success){setMensaje(data.message);// Guardamos todo el objeto de usuario en localStorage.\n// El `rolAutenticacion` viene del servidor, no de la selección del usuario.\nlocalStorage.setItem(\"usuarioLogueado\",JSON.stringify(data.user));localStorage.setItem(\"idUsuario\",data.user.id);// Guardar idUsuario si es necesario\nlocalStorage.setItem(\"cargoEmpleado\",data.user.cargoEmpleado);// Guardar cargoEmpleado si es necesario\n// Obtenemos el rol directamente del objeto de datos que nos dio el servidor\nconst userRole=data.user.rolAutenticacion?data.user.rolAutenticacion.toLowerCase():'';// Redirigir según el rol\nif(userRole===\"admin\"){navigate(\"/perfilAdmin\");}else if(userRole===\"usuario\"){navigate(\"/perfilUsuario\");}else{setMensaje(\"El rol de usuario recibido no es válido para redirección.\");}}else{// Mostrar mensaje de error del servlet\nsetMensaje(data.message||\"Credenciales incorrectas\");}}catch(error){console.error(\"Error al iniciar sesión:\",error);alert(\"Error al intentar iniciar sesión. Por favor, inténtalo de nuevo.\");}};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"header\",{className:\"encabezado\",children:[/*#__PURE__*/_jsx(\"img\",{src:logo,alt:\"Eslogan de CONI\",className:\"imagen-encabezado\"}),/*#__PURE__*/_jsx(\"div\",{className:\"barra-superior\",children:/*#__PURE__*/_jsx(\"nav\",{children:/*#__PURE__*/_jsx(\"ul\",{children:/*#__PURE__*/_jsx(\"li\",{children:/*#__PURE__*/_jsx(\"a\",{href:\"/\",children:\"Atr\\xE1s\"})})})})})]}),/*#__PURE__*/_jsxs(\"main\",{className:\"login\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"container textos-sesion\",children:/*#__PURE__*/_jsx(\"h1\",{children:\"\\xA1Inicia sesi\\xF3n!\"})}),/*#__PURE__*/_jsxs(\"form\",{className:\"inicio-sesion\",onSubmit:handleSubmit,required:true,children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\xBFC\\xF3mo deseas iniciar sesi\\xF3n?\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Ingresa tu nombre de usuario y contrase\\xF1a para acceder a tu cuenta.\"}),/*#__PURE__*/_jsx(\"h4\",{children:\"Usuario\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"username\",placeholder:\"Nombre de usuario\",required:true,onChange:handleChange}),/*#__PURE__*/_jsx(\"h4\",{children:\"Contrase\\xF1a\"}),/*#__PURE__*/_jsx(\"input\",{type:\"password\",name:\"password\",placeholder:\"Contrase\\xF1a\",required:true,autoComplete:\"current-password\",onChange:handleChange}),/*#__PURE__*/_jsx(\"h5\",{children:/*#__PURE__*/_jsx(\"a\",{href:\"/recuperar\",children:\"\\xBFolvidaste tu contrase\\xF1a?\"})}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Iniciar sesi\\xF3n\"})]}),mensaje&&/*#__PURE__*/_jsx(\"p\",{className:\"mensaje-feedback\",children:mensaje})]})]});}export default Login;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","logo","jsx","_jsx","jsxs","_jsxs","Login","formData","setFormData","username","password","mensaje","setMensaje","navigate","localStorage","removeItem","logoutMessage","getItem","handleChange","e","_objectSpread","target","name","value","handleSubmit","preventDefault","response","fetch","method","headers","credentials","body","JSON","stringify","data","json","ok","success","message","setItem","user","id","cargoEmpleado","userRole","rolAutenticacion","toLowerCase","error","console","alert","children","className","src","alt","href","onSubmit","required","type","placeholder","onChange","autoComplete"],"sources":["C:/Users/Lenovo/OneDrive/Documentos/SENA/CONI_FUNCIONES 10 NOV/frontend/src/components/login.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport logo from '../img/ESLOGAN CONI.png';\nimport './estilos.css'; // copia tu CSS de sesion.css aquí\n\nfunction Login() {\n\n  // --- EXPLICACIÓN: useState ---\n  // useState es un \"hook\" de React. Los hooks nos permiten usar el estado\n  // y otras características de React en componentes de función.\n  // En este caso, creamos un estado 'formData' para guardar los datos del formulario.\n  // NOTA: Hemos quitado el campo 'rol' de aquí, ya que no lo necesitamos más.\n\n  const [formData, setFormData] = useState({\n    username: '',\n    password: ''\n  });\n\n  const [mensaje, setMensaje] = useState('');\n  const navigate = useNavigate();\n\n  // --- EXPLICACIÓN: useEffect ---\n  // Este hook ejecuta un código cada vez que el componente se renderiza.\n  // El array vacío `[]` al final le dice a React que solo ejecute este código una vez,\n  // cuando el componente se \"monta\" (cuando aparece en la página por primera vez).\n  // Lo usamos para limpiar el localStorage.\n\n  useEffect(() => {\n\n    // Limpiamos el localStorage de cualquier sesión anterior.\n    // Esto asegura que la aplicación empiece siempre de forma limpia.\n    localStorage.removeItem(\"usuarioLogueado\");\n\n    // También limpiamos los campos del formulario por si acaso.\n    localStorage.removeItem(\"idUsuario\");\n    localStorage.removeItem(\"cargoEmpleado\");\n\n    const logoutMessage = localStorage.getItem(\"logoutMessage\");\n    if (logoutMessage) {\n      setMensaje(logoutMessage);\n      localStorage.removeItem(\"logoutMessage\"); // Limpia el mensaje después de leerlo\n    }\n  }, []); // El array vacío `[]` es crucial para que solo se ejecute una vez.\n\n  // --- EXPLICACIÓN: handleChange ---\n  // Esta función es llamada cada vez que el usuario escribe en los campos del formulario.\n  // Usa la sintaxis `...formData` para crear una copia de los datos actuales del formulario,\n  // y luego actualiza solo el campo que ha cambiado ([e.target.name] con su e.target.value).\n  // Ahora solo maneja 'username' y 'password'.\n  const handleChange = e => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value\n    });\n  };\n\n  // --- EXPLICACIÓN: handleSubmit ---\n  // Esta función se activa cuando el usuario envía el formulario.\n  // Envía los datos al servidor (backend) y maneja la respuesta.\n  const handleSubmit = async e => {\n    e.preventDefault();\n    setMensaje(''); // Limpiar mensaje previo\n\n    //verificamos que los campos no estén vacíos\n    if (!formData.username || !formData.password) {\n      setMensaje('Por favor, ingrese su nombre de usuario y contraseña.');\n      return;\n    }\n\n    try {\n      // Usamos `fetch` para enviar una solicitud al servidor.\n      // `async/await` nos permite trabajar con promesas (peticiones asíncronas)\n      // de una manera más fácil de leer.\n      const response = await fetch('http://localhost:8080/CONI1.0/LoginServlet', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include',\n        // --- CAMBIO CLAVE AQUÍ ---\n        // Ahora solo enviamos el nombre de usuario y la contraseña.\n        // El rol ya no está en el `formData` que se envía.\n        body: JSON.stringify(formData)\n      });\n\n      // --- EXPLICACIÓN: JSON y Servlet ---\n      // JSON (JavaScript Object Notation) es un formato ligero para el intercambio de datos.\n      // Es como un idioma universal para que el frontend y el backend se comuniquen.\n      // El `Servlet` es un programa en el servidor (backend) que procesa las peticiones web.\n      // En este caso, tu `LoginServlet` recibe los datos del formulario.\n      const data = await response.json();\n\n      // Si la respuesta del servidor es exitosa...\n      // Ajuste aquí: el servlet devuelve 'success' y el rol está dentro de 'data.user.rolAutenticacion'\n      if (response.ok && data.success) {\n        setMensaje(data.message);\n\n        // Guardamos todo el objeto de usuario en localStorage.\n        // El `rolAutenticacion` viene del servidor, no de la selección del usuario.\n        localStorage.setItem(\"usuarioLogueado\", JSON.stringify(data.user));\n        localStorage.setItem(\"idUsuario\", data.user.id); // Guardar idUsuario si es necesario\n        localStorage.setItem(\"cargoEmpleado\", data.user.cargoEmpleado); // Guardar cargoEmpleado si es necesario\n\n        // Obtenemos el rol directamente del objeto de datos que nos dio el servidor\n        const userRole = data.user.rolAutenticacion ? data.user.rolAutenticacion.toLowerCase() : '';\n\n        // Redirigir según el rol\n        if (userRole === \"admin\") {\n          navigate(\"/perfilAdmin\");\n        } else if (userRole === \"usuario\") {\n          navigate(\"/perfilUsuario\");\n        } else {\n          setMensaje(\"El rol de usuario recibido no es válido para redirección.\");\n        }\n      } else {\n        // Mostrar mensaje de error del servlet\n        setMensaje(data.message || \"Credenciales incorrectas\");\n      }\n    } catch (error) {\n      console.error(\"Error al iniciar sesión:\", error);\n      alert(\"Error al intentar iniciar sesión. Por favor, inténtalo de nuevo.\");\n    }\n  };\n\n  return (\n    <div>\n      <header className=\"encabezado\">\n        <img src={logo} alt=\"Eslogan de CONI\" className=\"imagen-encabezado\" />\n        <div className=\"barra-superior\">\n          <nav>\n            <ul>\n              <li><a href=\"/\">Atrás</a></li>\n            </ul>\n          </nav>\n        </div>\n      </header>\n\n      <main className='login'>\n        <div className=\"container textos-sesion\">\n          <h1>¡Inicia sesión!</h1>\n        </div>\n        <form className=\"inicio-sesion\" onSubmit={handleSubmit} required>\n\n          <h4>¿Cómo deseas iniciar sesión?</h4>\n          <p>Ingresa tu nombre de usuario y contraseña para acceder a tu cuenta.</p>\n\n          <h4>Usuario</h4>\n          <input type=\"text\" \n          name=\"username\" \n          placeholder=\"Nombre de usuario\" \n          required \n          onChange={handleChange} />\n\n          <h4>Contraseña</h4>\n          <input type=\"password\" \n          name=\"password\" \n          placeholder=\"Contraseña\" \n          required \n          autoComplete=\"current-password\" \n          onChange={handleChange} />\n\n          <h5><a href=\"/recuperar\">¿olvidaste tu contraseña?</a></h5>\n\n          <button type=\"submit\">Iniciar sesión</button>\n        </form>\n        {mensaje && <p className=\"mensaje-feedback\">{mensaje}</p>}\n      </main>\n    </div>\n  );\n}\n\nexport default Login;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}